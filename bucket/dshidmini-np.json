{
    "version": "2.2.282.0",
    "description": "Virtual HID Mini-user-mode-driver for Sony DualShock 3 Controllers",
    "homepage": "https://vigem.org/projects/DsHidMini/",
    "license": "BSD-3-Clause",
    "url": "https://github.com/ViGEm/DsHidMini/releases/download/v2.2.282.0/dshidmini_v2.2.282.0.zip",
    "hash": "bca2f780c16e7da665bbd62685014169c9e752426b87a3e2804801e0a50d0073",
    "pre_install": [
        "if (-not $global) {",
        "    Write-Host -Foreground Red \"$app should be installed globally.\"",
        "    exit 1",
        "}"
    ],
    "installer": {
        "script": [
            "$driver_dir = (\"$dir\\x64\\dshidmini\",\"$dir\\x86\\dshidmini\")[$architecture -eq '32bit']",
            "",
            "# Add cert first before installing driver",
            "$cert = (Get-AuthenticodeSignature \"$driver_dir\\dshidmini.cat\").SignerCertificate",
            "$checkCert = Get-ChildItem Cert:\\CurrentUser\\TrustedPublisher -Recurse | Where-Object { $_.Thumbprint -eq $cert.Thumbprint }",
            "if (!($checkCert)) {",
            "    Write-Host \"Cert not found, adding to trusted store...\"",
            "    [System.IO.File]::WriteAllBytes(\"$driver_dir\\Nefarius.cer\", $cert.Export([System.Security.Cryptography.X509Certificates.X509ContentType]::Cert))",
            "    certutil -addstore -f \"TrustedPublisher\" \"$driver_dir\\Nefarius.cer\"",
            "    Remove-Item \"$driver_dir\\Nefarius.cer\"",
            "}",
            "",
            "Write-Host \"Installing driver...\"",
            "Invoke-ExternalCommand pnputil -ArgumentList @('/add-driver', \"$driver_dir\\dshidmini.inf\", '/install') -RunAs -ContinueExitCodes @{ 3010 = 'A system reboot is required to finalize the installation.' } | Out-Null"
        ]
    },
    "shortcuts": [
        [
            "DSHMC.exe",
            "DsHidMini Control Utility"
        ]
    ],
    "uninstaller": {
        "script": [
            "if ($cmd -ne 'uninstall') { return }",
            "$driver_dir = (\"$dir\\x64\\dshidmini\",\"$dir\\x86\\dshidmini\")[$architecture -eq '32bit']",
            "Invoke-ExternalCommand pnputil -ArgumentList @('/delete-driver', \"$driver_dir\\dshidmini.inf\", '/uninstall', '/force') -RunAs -ContinueExitCodes @{ 3010 = 'A system reboot is required to finalize the uninstallation.' } | Out-Null"
        ]
    },
    "checkver": {
        "github": "https://github.com/ViGEm/DsHidMini"
    },
    "autoupdate": {
        "url": "https://github.com/ViGEm/DsHidMini/releases/download/v$version/dshidmini_v$version.zip"
    }
}
